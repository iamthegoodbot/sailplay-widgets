!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.PortholeClass=function(){},PortholeClass.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}(),function(a){var b={debug:!1,trace:function(b){this.debug&&void 0!==a.console&&a.console.log("Porthole: "+b)},error:function(b){void 0!==a.console&&a.console.error("Porthole: "+b)}};b.WindowProxy=function(){},b.WindowProxy.prototype={post:function(a,b){},addEventListener:function(a){},removeEventListener:function(a){}},b.WindowProxyBase=PortholeClass.extend({init:function(b){void 0===b&&(b=""),this.targetWindowName=b,this.origin=a.location.protocol+"//"+a.location.host,this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},getTargetWindow:function(){return b.WindowProxy.getTargetWindow(this.targetWindowName)},post:function(b,c){void 0===c&&(c="*"),this.dispatchMessage({data:b,sourceOrigin:this.getOrigin(),targetOrigin:c,sourceWindowName:a.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(a){return this.eventListeners.push(a),a},removeEventListener:function(a){var b;try{b=this.eventListeners.indexOf(a),this.eventListeners.splice(b,1)}catch(c){this.eventListeners=[]}},dispatchEvent:function(a){var b;for(b=0;b<this.eventListeners.length;b++)try{this.eventListeners[b](a)}catch(c){}}}),b.WindowProxyLegacy=b.WindowProxyBase.extend({init:function(a,c){this._super(c),null!==a?(this.proxyIFrameName=this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=a,this.proxyIFrameElement=this.createIFrameProxy()):(this.proxyIFrameElement=null,b.trace("proxyIFrameUrl is null, window will be a receiver only"),this.post=function(){throw new Error("Receiver only window")})},createIFrameProxy:function(){var a=document.createElement("iframe");return a.setAttribute("id",this.proxyIFrameName),a.setAttribute("name",this.proxyIFrameName),a.setAttribute("src",this.proxyIFrameLocation),a.setAttribute("frameBorder","1"),a.setAttribute("scrolling","auto"),a.setAttribute("width",30),a.setAttribute("height",30),a.setAttribute("style","position: absolute; left: -100px; top:0px;"),a.style.setAttribute&&a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;"),document.body.appendChild(a),a},dispatchMessage:function(c){var d=a.encodeURIComponent;if(this.proxyIFrameElement){var e=this.proxyIFrameLocation+"#"+d(b.WindowProxy.serialize(c));this.proxyIFrameElement.setAttribute("src",e),this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}}}),b.WindowProxyHTML5=b.WindowProxyBase.extend({init:function(a,b){this._super(b),this.eventListenerCallback=null},dispatchMessage:function(a){this.getTargetWindow().postMessage(b.WindowProxy.serialize(a),a.targetOrigin)},addEventListener:function(b){if(0===this.eventListeners.length){var c=this;a.addEventListener?(this.eventListenerCallback=function(a){c.eventListener(c,a)},a.addEventListener("message",this.eventListenerCallback,!1)):a.attachEvent&&(this.eventListenerCallback=function(b){c.eventListener(c,a.event)},a.attachEvent("onmessage",this.eventListenerCallback))}return this._super(b)},removeEventListener:function(b){this._super(b),0===this.eventListeners.length&&(a.removeEventListener?a.removeEventListener("message",this.eventListenerCallback):a.detachEvent&&("undefined"==typeof a.onmessage&&(a.onmessage=null),a.detachEvent("onmessage",this.eventListenerCallback)),this.eventListenerCallback=null)},eventListener:function(a,c){var d=b.WindowProxy.unserialize(c.data);!d||""!==a.targetWindowName&&d.sourceWindowName!=a.targetWindowName||a.dispatchEvent(new b.MessageEvent(d.data,c.origin,a))}}),a.postMessage?(b.trace("Using built-in browser support"),b.WindowProxy=b.WindowProxyHTML5.extend({})):(b.trace("Using legacy browser support"),b.WindowProxy=b.WindowProxyLegacy.extend({})),b.WindowProxy.serialize=function(a){if("undefined"==typeof JSON)throw new Error("Porthole serialization depends on JSON!");return JSON.stringify(a)},b.WindowProxy.unserialize=function(a){if("undefined"==typeof JSON)throw new Error("Porthole unserialization dependens on JSON!");try{var b=JSON.parse(a)}catch(c){return!1}return b},b.WindowProxy.getTargetWindow=function(b){return""===b?parent:"top"===b||"parent"===b?a[b]:a.frames[b]},b.MessageEvent=function(a,b,c){this.data=a,this.origin=b,this.source=c},b.WindowProxyDispatcher={forwardMessageEvent:function(c){var d,e,f,g=a.decodeURIComponent;document.location.hash.length>0&&(d=b.WindowProxy.unserialize(g(document.location.hash.substr(1))),e=b.WindowProxy.getTargetWindow(d.targetWindowName),f=b.WindowProxyDispatcher.findWindowProxyObjectInWindow(e,d.sourceWindowName),f?f.origin===d.targetOrigin||"*"===d.targetOrigin?f.dispatchEvent(new b.MessageEvent(d.data,d.sourceOrigin,f)):b.error("Target origin "+f.origin+" does not match desired target of "+d.targetOrigin):b.error("Could not find window proxy object on the target window"))},findWindowProxyObjectInWindow:function(a,b){var c;if(a)for(c in a)if(Object.prototype.hasOwnProperty.call(a,c))try{if(null!==a[c]&&"object"==typeof a[c]&&a[c]instanceof a.Porthole.WindowProxy&&a[c].getTargetWindowName()===b)return a[c]}catch(d){}return null},start:function(){a.addEventListener?a.addEventListener("resize",b.WindowProxyDispatcher.forwardMessageEvent,!1):a.attachEvent&&"undefined"!==a.postMessage?a.attachEvent("onresize",b.WindowProxyDispatcher.forwardMessageEvent):document.body.attachEvent?a.attachEvent("onresize",b.WindowProxyDispatcher.forwardMessageEvent):b.error("Cannot attach resize event")}},"undefined"!=typeof a.exports?a.exports.Porthole=b:a.Porthole=b}(this);var SAILPLAY=function(){function a(){alert("Please init SailPlay HUB first!")}function b(a){function b(a){return"login.success"==a.data.name?void f.send("login.do",a.data.auth_hash):"login.cancel"==a.data.name?void f.send("login.cancel"):"login.check"==a.data.name?void("None"==a.data.auth_hash?f.send("logout"):f.send("login.do",a.data.auth_hash)):void("logout.success"==a.data.name&&(h.auth_hash="",d.eraseCookie("sp_auth_hash"),f.send("logout.success")))}return"undefined"==typeof Porthole?void alert("SailPlay: Porthole.js library need to be installed"):void(1==a.nodeType&&"IFRAME"==a.tagName?(a.src=h.DOMAIN+"/users/auth-page/?partner_id="+h.partner.id+"&dep_id="+h.dep_id,j=new Porthole.WindowProxy("",a.name),j.addEventListener(b)):alert("SailPlay: provide <iframe> DOM element as parameter (Remote login)"))}function c(a){var b={gift_public_key:a.gift_public_key,auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.gifts.purchase.force_confirm,b,function(a){"ok"==a.status?f.send("gift.purchase.force_complete.success",a):f.send("gift.purchase.force_complete.error",a)})}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1});var d={createCookie:function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},eraseCookie:function(a){d.createCookie(a,"",-1)}},e={currentScript:null,get:function(a,b,c,d){var e=a+(a.indexOf("?")+1?"&":"?"),f=document.getElementsByTagName("head")[0],g=document.createElement("script"),i=[];h.auth_hash||delete b.auth_hash,window.JSONP_CALLBACK=window.JSONP_CALLBACK||{};var j="sailplay_"+(new Date).getTime()+Math.random().toString().replace(".",""),k=setTimeout(function(){try{f.removeChild(g)}catch(a){}delete window.JSONP_CALLBACK[j]},1e4);window.JSONP_CALLBACK[j]=function(a){clearTimeout(k),f.removeChild(g),delete window.JSONP_CALLBACK[j],c&&c(a)},b.callback="JSONP_CALLBACK."+j;for(var l in b)i.push(l+"="+encodeURIComponent(b[l]));e+=i.join("&"),g.type="text/javascript",g.src=e,g.onerror=function(a){f.removeChild(g),delete window.JSONP_CALLBACK[j],d&&d(a)},f.insertBefore(g,f.firstChild)},success:null},f={},g={};f.on=function(a,b){"undefined"==typeof g[a]&&(g[a]=[]),g[a].push(b)},f.send=function(a,b){if(g[a])for(var c=0;c<g[a].length;c++)g[a][c](b)};var h={},i={},j=!1;f.on("init",function(a){return a||alert("SailPlay: provide required parameters"),a.partner_id?void e.get((a.domain||"http://sailplay.ru")+"/js-api/"+a.partner_id+"/config/",{lang:a.lang||"ru"},function(b){b&&"ok"==b.status?(h=b.config,h.DOMAIN=a.domain||"http://sailplay.ru",h.dep_id=a.dep_id||"",h.env.staticUrl=a.static_url||h.env.staticUrl,f.send("init.success",h)):(f.send("init.error",b),alert("SailPlay: app load failed!"))}):void alert("SailPlay: provide partner_id")}),f.on("init.remote",function(a){b(a)}),f.on("language.set",function(b){return h=={}?void a():void("string"==typeof b&&e.get(h.DOMAIN+"/js-api/"+h.partner.id+"/config/",{lang:b},function(a){a&&"ok"==a.status?(h.lang=a.config.lang,f.send("language.set.success",h.lang)):f.send("language.set.error",a)}))}),f.config=function(){return h},f.on("login.do",function(a){h.auth_hash=a;var b={auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.users.info,b,function(a){"ok"==a.status?f.send("login.success",a.user):(h.auth_hash="",f.send("login.error",a))})}),f.on("login",function(b){return h=={}?void a():void f.send("login.do",b)}),f.on("logout",function(){return h=={}?void a():(h.auth_hash&&j&&j.post({name:"logout"}),h.auth_hash="",d.eraseCookie("sp_auth_hash"),void f.send("logout.success"))}),f.on("load.user.info",function(){if(h=={})return void a();var b={auth_hash:h.auth_hash,user_status:1,badges:1,last_badge:1};e.get(h.DOMAIN+h.urls.users.info,b,function(a){"ok"==a.status?f.send("load.user.info.success",a):f.send("load.user.info.error",a)})}),f.on("load.user.history",function(){if(h=={})return void a();var b={auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.users.history,b,function(a){"ok"==a.status?f.send("load.user.history.success",a.history):f.send("load.user.history.error",a)})}),f.on("gifts.get",function(b){if(h=={})return void a();var c={gift_id:b,auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.gifts.get,c,function(a){"ok"==a.status?f.send("gifts.get.success",a.gift):f.send("gifts.get.error",a)})}),f.on("load.gifts.list",function(){if(h=={})return void a();var b={auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.gifts.list,b,function(a){"ok"==a.status?f.send("load.gifts.list.success",a.gifts):f.send("load.gifts.list.error",a)})}),f.on("gifts.purchase",function(b){if(h=={})return void a();if(h.auth_hash){var d={gift_id:b.id,dep_id:h.dep_id||h.partner.depId||"",auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.gifts.purchase.purchase,d,function(a){if("ok"==a.status){if(f.send("gifts.purchase.success",a),a.is_completed){var b=a;if(b.request_to_partner_url){var d={gift_public_key:b.gift_public_key,gift_sku:b.gift_sku,auth_hash:h.auth_hash};b.user_phone&&(d.user_phone=b.user_phone),b.email&&(d.email=b.email),e.get(b.request_to_partner_url,d,function(a){f.send("gifts.purchase.partner_request.success",a)},function(a){f.send("gifts.purchase.partner_request.error",a),c(b)})}else c(b)}}else f.send("gift.purchase.error",a)})}else f.send("gifts.purchase.auth.error",b)}),f.on("load.badges.list",function(){if(h=={})return void a();var b={auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.badges.list,b,function(a){"ok"==a.status?f.send("load.badges.list.success",a):f.send("load.badges.list.error",a)})}),f.on("load.actions.list",function(){if(h=={})return void a();var b={auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.actions.load,b,function(a){"ok"==a.status?(i=a.data,f.send("load.actions.list.success",a.data)):f.send("load.actions.list.error",a)})});var k={};return k.openSocialRegNeedPopup=function(a){var b;b="vk"==a.socialType?k.popupWindow(i.social.vk.authUrl,"social_reg",840,400):k.popupWindow(i.social[a.socialType].authUrl,"social_reg");var c=setInterval(function(){(null==b||b.closed)&&(f.send("actions.social.connect.complete"),clearInterval(c))},100)},k.popupWindow=function(a,b,c,d){var e,f,g,h;return void 0!==c&&void 0!==d?(e=c,f=d,g=screen.width/2-c/2,h=screen.height/2-d/2):(e=screen.width/2,f=screen.height/2,g=e-e/2,h=f-f/2),window.open(a,b,"toolbar=no, location=no, directories=no, status=no, menubar=no, copyhistory=no, width="+e+", height="+f+", top="+h+", left="+g)},k.share=function(a){var b=h.DOMAIN+"/js-api/"+h.partner.id+"/actions/social-widget/?auth_hash="+h.auth_hash;b+="&socialType="+a.socialType+"&action="+a.action+"&link="+a.shortLink+"&pic="+(i.partnerCustomPic?i.partnerCustomPic:h.partner.logo),b+="&msg="+i.messages[a.action],b+="&_actionId="+a._actionId,"purchase"==a.action&&(b+="&purchasePublicKey="+i.purchasePublicKey);var c=k.popupWindow(b,"social_action",200,210),d=setInterval(function(){(null==c||c.closed)&&(f.send("actions.perform.complete",a),clearInterval(d))},200)},k.perform=function(a){var b=h.DOMAIN+"/popup/"+h.partner.id+"/widgets/custom/"+a.type+"/?auth_hash="+h.auth_hash;b+="&lang="+h.lang,b+="&from_sdk=0";var c=k.popupWindow(b,"SailPlay",600,400),d=setInterval(function(){(null==c||c.closed)&&(f.send("actions.perform.complete",a),clearInterval(d))},200)},f.on("actions.perform",function(b){return h=={}?void a():void(h.auth_hash?(f.send("actions.perform.start",b),b.socialType?i.connectedAccounts[b.socialType]?k.share(b):k.openSocialRegNeedPopup(b):k.perform(b)):f.send("actions.perform.auth.error",b))}),f.on("promocodes.apply",function(b){return h=={}?void a():(b.auth_hash=h.auth_hash,void(h.auth_hash?e.get(h.DOMAIN+h.urls.promocodes.apply,b,function(a){"ok"==a.status?f.send("promocodes.apply.success",a):f.send("promocodes.apply.error",a)}):f.send("promocodes.apply.auth.error",action)))}),f.on("tags.add",function(b){if(h=={})return void a();if(h.auth_hash){var c={tags:b.join(","),auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.tags.add,c,function(a){"ok"==a.status?f.send("tags.add.success",a):f.send("tags.add.error",a)})}else SAILPLAY.trigger("tags.add.auth.error",b)}),f.on("leaderboard.load",function(){if(h=={})return void a();var b={auth_hash:h.auth_hash};e.get(h.DOMAIN+h.urls.leaderboard.data,b,function(a){"ok"==a.status?f.send("leaderboard.load.success",a.data):f.send("leaderboard.load.error",a)})}),f}();